<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Model parameters</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorials-models-model-parameters.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Model parameters</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md112">Problem description</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md113">Parameter vs buffer</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md114">Retrieving the parameter value</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md115">Updating the parameter value</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_content_2tutorials_2models_2model__parameters_2main"></a></p>
<h1><a class="anchor" id="autotoc_md112"></a>
Problem description</h1>
<p>In this tutorial, we will revisit the problem defined in the previous tutorial and demonstrate how to work with model parameters.</p>
<p>Recall that the linear elasticity material model can be mathematically written as   </p><p class="formulaDsp">
\[  \boldsymbol{\sigma} = 3 K \operatorname{vol} \boldsymbol{\varepsilon} + 2 G \operatorname{dev} \boldsymbol{\varepsilon}.
\]
</p>
<p> Also recall that all NEML2 models can be written in the following general form   </p><p class="formulaDsp">
\[  y = f(x; p, b).
\]
</p>
<p> Pattern matching suggests the following set definitions:   </p><p class="formulaDsp">
\[  x = \left\{ \boldsymbol{\varepsilon} \right\}, \quad y = \left\{ \boldsymbol{\sigma} \right\}, \quad p = \left\{ K, G \right\}, \quad b = \varnothing.
\]
</p>
<h1><a class="anchor" id="autotoc_md113"></a>
Parameter vs buffer</h1>
<p>Both \( K \) and \( G \) are here categorized as model parameters. The major differences between parameters and buffers are</p><ul>
<li>Parameters are "trainable", whereas buffers are not. NEML2 can use automatic differentiation to calculate the derivative of output variables with respect to the model parameters, but not for the model buffers.</li>
<li>Parameters can be (recursively) defined by other models, whereas buffers cannot. This feature is discussed in a <a class="el" href="tutorials-models-model-parameters-revisited.html">later tutorial</a>.</li>
</ul>
<p>In summary, a parameter is a more powerful superset of a buffer. However, there is overhead cost associated with maintaining a parameter that buffers avoid.</p>
<dl class="section note"><dt>Note</dt><dd>Some models allow users to choose whether to declare data as parameters or buffers.</dd></dl>
<h1><a class="anchor" id="autotoc_md114"></a>
Retrieving the parameter value</h1>
<p>All model parameters are associated with a unique name, either predefined by the model itself or chosen by the user. The following code iterates through all parameters in the model and print out their values:</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/models/Model.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp; [pname, pval] : model-&gt;named_parameters())</div>
<div class="line">    std::cout &lt;&lt; pname &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span> &lt;&lt; <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(*pval) &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1Tensor_html"><div class="ttname"><a href="classneml2_1_1Tensor.html">neml2::Tensor</a></div><div class="ttdef"><b>Definition</b> Tensor.h:46</div></div>
<div class="ttc" id="anamespaceneml2_html"><div class="ttname"><a href="namespaceneml2.html">neml2</a></div><div class="ttdef"><b>Definition</b> DiagnosticsInterface.cxx:29</div></div>
<div class="ttc" id="anamespaceneml2_html_aa98735f2ffd7c3ae8b0b339621eb8ab3"><div class="ttname"><a href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">neml2::load_model</a></div><div class="ttdeci">std::shared_ptr&lt; Model &gt; load_model(const std::filesystem::path &amp;path, const std::string &amp;mname)</div><div class="ttdoc">A convenient function to load an input file and get a model.</div><div class="ttdef"><b>Definition</b> Model.cxx:41</div></div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G:</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">K:</div>
<div class="line">140000</div>
<div class="line">[ CPUFloatType{} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> neml2</div>
<div class="line"> </div>
<div class="line">model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">neml2.load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> pname, pval <span class="keywordflow">in</span> model.named_parameters().items():</div>
<div class="line">  print(<span class="stringliteral">&quot;{}:&quot;</span>.format(pname))</div>
<div class="line">  print(pval.tensor())</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G:</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
<div class="line">K:</div>
<div class="line">140000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><p><a class="el" href="classneml2_1_1ParameterStore.html#a60154f948f092f7b1484a3148c9ed316" title="}@">neml2::Model::get_parameter</a> can be used to retrieve a specific parameter given its name. In other words, the above code is equivalent to</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/models/Model.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> &amp; G = model-&gt;get_parameter(<span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line">  <span class="keyword">auto</span> &amp; K = model-&gt;get_parameter(<span class="stringliteral">&quot;K&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;G:\n&quot;</span> &lt;&lt; <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(G) &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;K:\n&quot;</span> &lt;&lt; <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(K) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G:</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">K:</div>
<div class="line">140000</div>
<div class="line">[ CPUFloatType{} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> In Python, model parameters can be more conveniently retrieved as attributes, i.e.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> neml2</div>
<div class="line"> </div>
<div class="line">model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">neml2.load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>)</div>
<div class="line"> </div>
<div class="line">G = model.G</div>
<div class="line">K = model.K</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;G:&quot;</span>)</div>
<div class="line">print(G.tensor())</div>
<div class="line">print(<span class="stringliteral">&quot;K:&quot;</span>)</div>
<div class="line">print(K.tensor())</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G:</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
<div class="line">K:</div>
<div class="line">140000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><h1><a class="anchor" id="autotoc_md115"></a>
Updating the parameter value</h1>
<p>Model parameters can always be changed by changing the input file. However, in certain cases (e.g., training and optimization), the parameter values should preferrably be updated at runtime (e.g., after each epoch or optimization iteration).</p>
<p>The <a class="el" href="classneml2_1_1ParameterStore.html#a1fdcb02ea1c3d6e1828424ccd400fa36" title="Set the value for a parameter.">neml2::Model::set_parameter</a> and <a class="el" href="classneml2_1_1ParameterStore.html#a2d96d9f92a985de65651abf452cb49a2" title="Set values for parameters.">neml2::Model::set_parameters</a> methods can be used for that purpose:</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/models/Model.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Scalar.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Before modification</span></div>
<div class="line">  <span class="keyword">auto</span> &amp; G = model-&gt;get_parameter(<span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;G (before modification):\n&quot;</span> &lt;&lt; <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(G) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// After modification</span></div>
<div class="line">  G = <a class="code hl_function" href="classneml2_1_1PrimitiveTensor.html#a0eb4c776dfa03b8189246d2e8b0f7990">Scalar::full</a>(59000);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;G (after modification):\n&quot;</span> &lt;&lt; <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(G) &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1PrimitiveTensor_html_a0eb4c776dfa03b8189246d2e8b0f7990"><div class="ttname"><a href="classneml2_1_1PrimitiveTensor.html#a0eb4c776dfa03b8189246d2e8b0f7990">neml2::PrimitiveTensor&lt; Scalar &gt;::full</a></div><div class="ttdeci">static Scalar full(const CScalar &amp;init, const TensorOptions &amp;options=default_tensor_options())</div><div class="ttdef"><b>Definition</b> PrimitiveTensor.h:214</div></div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G (before modification):</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">G (after modification):</div>
<div class="line">59000</div>
<div class="line">[ CPUFloatType{} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> neml2</div>
<div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Scalar</div>
<div class="line"> </div>
<div class="line">model = <a class="code hl_function" href="namespaceneml2.html#aa98735f2ffd7c3ae8b0b339621eb8ab3">neml2.load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;my_model&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Before modification</span></div>
<div class="line">print(<span class="stringliteral">&quot;G (before modification):&quot;</span>)</div>
<div class="line">print(model.G.tensor())</div>
<div class="line"> </div>
<div class="line"><span class="comment"># After modification</span></div>
<div class="line">model.G = Scalar.full(59000)</div>
<div class="line">print(<span class="stringliteral">&quot;G (after modification):&quot;</span>)</div>
<div class="line">print(model.G.tensor())</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">G (before modification):</div>
<div class="line">78000</div>
<div class="line">[ CPUFloatType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
<div class="line">G (after modification):</div>
<div class="line">59000</div>
<div class="line">[ CPUDoubleType{} ]</div>
<div class="line">&lt;Tensor of shape [][]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="tutorials-models-running-your-first-model.html">Running your first model</a>   </td><td class="markdownTableBodyRight"><a class="el" href="tutorials-models-evaluation-device.html">Evaluation device</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
