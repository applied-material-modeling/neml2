<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: The forward operator</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorials-extension-the-forward-operator.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The forward operator</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md82">Method signature</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md83">Implementation</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md84">Evaluation</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_content_2tutorials_2extension_2the__forward__operator_2main"></a></p>
<h1><a class="anchor" id="autotoc_md82"></a>
Method signature</h1>
<p>The base class <a class="el" href="classneml2_1_1Model.html" title="The base class for all constitutive models.">neml2::Model</a> declares a pure virtual method <a class="el" href="classneml2_1_1Model.html#a6a028925dc10166ea6426fc4d7635ad2" title="The map between input -&gt; output, and optionally its derivatives.">neml2::Model::set_value</a> for derived classes to define the forward operator. The forward operator is responsible for calculating output variables given input variables, parameters, and buffers. Optionally, the <a class="el" href="classneml2_1_1Model.html#a6a028925dc10166ea6426fc4d7635ad2" title="The map between input -&gt; output, and optionally its derivatives.">neml2::Model::set_value</a> method can define derivatives and second derivatives, if requested.</p>
<p>The signature of the method is </p><div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> set_value(<span class="keywordtype">bool</span>, <span class="keywordtype">bool</span>, <span class="keywordtype">bool</span>) = 0;</div>
</div><!-- fragment --><p> The three boolean arguments denote whether the caller is requesting output variable values, their derivatives, or their second derivatives. Derived classes should therefore override this method, i.e. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> set_value(<span class="keywordtype">bool</span>, <span class="keywordtype">bool</span>, <span class="keywordtype">bool</span>) <span class="keyword">override</span>;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md83"></a>
Implementation</h1>
<p>By default, the model forward operator is responsible for calculating the output variable values and their first derivatives. Definition of second order derivatives is not required. Such default behavior can be changed by modifying the corresponding input file option in <a class="el" href="classneml2_1_1Model.html#acec712ff48d4c0884a1362c116f3257a">neml2::Model::expected_options</a>, i.e. </p><div class="fragment"><div class="line">options.set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;define_values&quot;</span>) = <span class="keyword">true</span>;</div>
<div class="line">options.set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;define_derivatives&quot;</span>) = <span class="keyword">true</span>;</div>
<div class="line">options.set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;define_second_derivatives&quot;</span>) = <span class="keyword">false</span>;</div>
</div><!-- fragment --><p> In other words, the default configuration guarantees the third boolean argument of <a class="el" href="classneml2_1_1Model.html#a6a028925dc10166ea6426fc4d7635ad2" title="The map between input -&gt; output, and optionally its derivatives.">neml2::Model::set_value</a> to always be false, while at least one of the first two boolean arguments is true.</p>
<p>Recall that the equation for this model is   </p><p class="formulaDsp">
\[  \boldsymbol{a} = \boldsymbol{g} - \mu \boldsymbol{v}.
\]
</p>
<p> The forward operator can be implemented as </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code hl_function" href="classneml2_1_1ProjectileAcceleration.html#ae6396730f8e20adc1c9d3875c473acdd">ProjectileAcceleration::set_value</a>(<span class="keywordtype">bool</span> out, <span class="keywordtype">bool</span> dout, <span class="keywordtype">bool</span> <span class="comment">/*d2out*/</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (out)</div>
<div class="line">    <a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a2a6d883e66e282fd6ae13155c1c071e9">_a</a> = <a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a735fbf1c41fa017f70c4abee922d032e">_g</a> - <a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#ae052393230c00bcdf7aebdf158a9d9dc">_mu</a> * <a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a4d09339c2d851ac3fef30e9f06f1d782">_v</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (dout)</div>
<div class="line">    <a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a2a6d883e66e282fd6ae13155c1c071e9">_a</a>.d(<a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a4d09339c2d851ac3fef30e9f06f1d782">_v</a>) = -<a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#ae052393230c00bcdf7aebdf158a9d9dc">_mu</a> * <a class="code hl_function" href="classneml2_1_1Vec.html#ae8ea0aeeeb359cde236d6f350a18783a">Vec::identity_map</a>(<a class="code hl_variable" href="classneml2_1_1ProjectileAcceleration.html#a4d09339c2d851ac3fef30e9f06f1d782">_v</a>.options());</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_a2a6d883e66e282fd6ae13155c1c071e9"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#a2a6d883e66e282fd6ae13155c1c071e9">neml2::ProjectileAcceleration::_a</a></div><div class="ttdeci">Variable&lt; Vec &gt; &amp; _a</div><div class="ttdoc">Acceleration of the projectile (output variable)</div><div class="ttdef"><b>Definition</b> src1.cxx:19</div></div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_a4d09339c2d851ac3fef30e9f06f1d782"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#a4d09339c2d851ac3fef30e9f06f1d782">neml2::ProjectileAcceleration::_v</a></div><div class="ttdeci">const Variable&lt; Vec &gt; &amp; _v</div><div class="ttdoc">Velocity of the projectile (input variable)</div><div class="ttdef"><b>Definition</b> src1.cxx:16</div></div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_a735fbf1c41fa017f70c4abee922d032e"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#a735fbf1c41fa017f70c4abee922d032e">neml2::ProjectileAcceleration::_g</a></div><div class="ttdeci">const Vec &amp; _g</div><div class="ttdoc">Gravitational acceleration (parameter)</div><div class="ttdef"><b>Definition</b> src1.cxx:22</div></div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_ae052393230c00bcdf7aebdf158a9d9dc"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#ae052393230c00bcdf7aebdf158a9d9dc">neml2::ProjectileAcceleration::_mu</a></div><div class="ttdeci">const Scalar &amp; _mu</div><div class="ttdoc">Dynamic viscosity of the medium (parameter)</div><div class="ttdef"><b>Definition</b> src1.cxx:25</div></div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_ae6396730f8e20adc1c9d3875c473acdd"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#ae6396730f8e20adc1c9d3875c473acdd">neml2::ProjectileAcceleration::set_value</a></div><div class="ttdeci">void set_value(bool, bool, bool) override</div><div class="ttdoc">The map between input -&gt; output, and optionally its derivatives.</div><div class="ttdef"><b>Definition</b> src1.cxx:13</div></div>
<div class="ttc" id="aclassneml2_1_1Vec_html_ae8ea0aeeeb359cde236d6f350a18783a"><div class="ttname"><a href="classneml2_1_1Vec.html#ae8ea0aeeeb359cde236d6f350a18783a">neml2::Vec::identity_map</a></div><div class="ttdeci">static R2 identity_map(const TensorOptions &amp;options=default_tensor_options())</div><div class="ttdoc">The derivative of a Vec with respect to itself.</div><div class="ttdef"><b>Definition</b> Vec.cxx:42</div></div>
<div class="ttc" id="anamespaceneml2_html"><div class="ttname"><a href="namespaceneml2.html">neml2</a></div><div class="ttdef"><b>Definition</b> DiagnosticsInterface.cxx:30</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md84"></a>
Evaluation</h1>
<p>The model definition is said to be <em>complete</em> once all components are properly defined. Custom models can be evaluated in the same way as existing models that come with NEML2.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line">  <span class="keyword">auto</span> &amp; model = <a class="code hl_function" href="namespaceneml2.html#a1e499dee97d6a66663f60dd4a65b9f1a">load_model</a>(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;accel&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Input velocity</span></div>
<div class="line">  <span class="keyword">auto</span> vel_name = <a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">  <span class="keyword">auto</span> vel = <a class="code hl_function" href="classneml2_1_1VecBase.html#a67d095774e372dbb57948c295e3d7924">Vec::fill</a>(10, 2, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Evaluate the model</span></div>
<div class="line">  <span class="keyword">auto</span> output = model.value({{vel_name, vel}});</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Output acceleration</span></div>
<div class="line">  <span class="keyword">auto</span> accel_name = <a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">  <span class="keyword">auto</span> &amp; accel = output[accel_name];</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Acceleration: \n&quot;</span> &lt;&lt; accel &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1VecBase_html_a67d095774e372dbb57948c295e3d7924"><div class="ttname"><a href="classneml2_1_1VecBase.html#a67d095774e372dbb57948c295e3d7924">neml2::VecBase&lt; Vec &gt;::fill</a></div><div class="ttdeci">static Vec fill(const Real &amp;v1, const Real &amp;v2, const Real &amp;v3, const TensorOptions &amp;options=default_tensor_options())</div><div class="ttdef"><b>Definition</b> VecBase.cxx:34</div></div>
<div class="ttc" id="anamespaceneml2_html_a16c96ec35672a72196d72131d3f5f8c3"><div class="ttname"><a href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">neml2::kFloat64</a></div><div class="ttdeci">constexpr auto kFloat64</div><div class="ttdef"><b>Definition</b> types.h:53</div></div>
<div class="ttc" id="anamespaceneml2_html_a1e499dee97d6a66663f60dd4a65b9f1a"><div class="ttname"><a href="namespaceneml2.html#a1e499dee97d6a66663f60dd4a65b9f1a">neml2::load_model</a></div><div class="ttdeci">Model &amp; load_model(const std::filesystem::path &amp;path, const std::string &amp;mname)</div><div class="ttdoc">A convenient function to load an input file and get a model.</div><div class="ttdef"><b>Definition</b> Model.cxx:47</div></div>
<div class="ttc" id="anamespaceneml2_html_a3c266b437e28eb7adec97c12b9a7e7d2"><div class="ttname"><a href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">neml2::set_default_dtype</a></div><div class="ttdeci">void set_default_dtype(Dtype dtype)</div><div class="ttdef"><b>Definition</b> defaults.cxx:32</div></div>
<div class="ttc" id="anamespaceneml2_html_a9e1488821b46ffc106c90ab80036b7aa"><div class="ttname"><a href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">neml2::VariableName</a></div><div class="ttdeci">LabeledAxisAccessor VariableName</div><div class="ttdef"><b>Definition</b> LabeledAxisAccessor.h:185</div></div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Acceleration: </div>
<div class="line">0.01 *</div>
<div class="line">-1.0000</div>
<div class="line">-981.2000</div>
<div class="line"> 0.0000</div>
<div class="line">[ CPUDoubleType{3} ]</div>
</div><!-- fragment --><div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="tutorials-extension-argument-declaration.html">Argument declaration</a>   </td><td class="markdownTableBodyRight"><a class="el" href="tutorials-extension-model-composition.html">Model composition</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
