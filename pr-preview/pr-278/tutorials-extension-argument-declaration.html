<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Argument declaration</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorials-extension-argument-declaration.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Argument declaration</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md73">Variable declaration</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md74">Parameter declaration</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md75">Model inspection</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_content_2tutorials_2extension_2argument__declaration_2main"></a></p>
<p>All NEML2 models can be written in the following form   </p><p class="formulaDsp">
\[
  y = f(x; p, b).
\]
</p>
<p>Defining a custom model therefore involves</p><ol type="1">
<li>declaring the input variables \(x\),</li>
<li>declaring the output variables \(y\),</li>
<li>declaring the parameters (and buffers, if any), and</li>
<li>defining the forward operator \(f\).</li>
</ol>
<p>The first three are introduced in this tutorial.</p>
<h1><a class="anchor" id="autotoc_md73"></a>
Variable declaration</h1>
<p>The API <a class="el" href="classneml2_1_1VariableStore.html#abebfaebbb9c5a3b42b6208b0979997b0" title="Declare an input variable.">neml2::Model::declare_input_variable</a> can be used to declare input variables. This method should be called in the constructor of the model. It allocate storage for the underlying tensor and returns a const-reference i.e., <code>const Variable&lt;T&gt; &amp;</code>, to the variable, where <code>T</code> is the variable tensor type. Similarly, the method <a class="el" href="classneml2_1_1VariableStore.html#a3586f9e5861f613dbfe349c7cda999e9" title="Declare an output variable.">neml2::Model::declare_output_variable</a> is for declaring output variables which returns a non-const-reference i.e., <code>Variable&lt;T&gt; &amp;</code>, to the variable.</p>
<p>In our example, the only input variable is \(\boldsymbol{v}\), and the only output variable is \(\boldsymbol{a}\). To declare them, first create the corresponding members in the class like </p><div class="fragment"><div class="line"><span class="comment">// Velocity of the projectile (input variable)</span></div>
<div class="line"><span class="keyword">const</span> Variable&lt;Vec&gt; &amp; _v;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Acceleration of the projectile (output variable)</span></div>
<div class="line">Variable&lt;Vec&gt; _a;</div>
</div><!-- fragment --><p> Then, use the variable declaration method in the constructor, i.e. </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line"><a class="code hl_function" href="classneml2_1_1ProjectileAcceleration.html#a83543b502da8255ced01db85b58bde37">ProjectileAcceleration::ProjectileAcceleration</a>(<span class="keyword">const</span> OptionSet &amp; options)</div>
<div class="line">  : Model(options),</div>
<div class="line">    _v(declare_input_variable&lt;Vec&gt;(<span class="stringliteral">&quot;velocity&quot;</span>)),</div>
<div class="line">    _a(declare_output_variable&lt;Vec&gt;(<span class="stringliteral">&quot;acceleration&quot;</span>))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1ProjectileAcceleration_html_a83543b502da8255ced01db85b58bde37"><div class="ttname"><a href="classneml2_1_1ProjectileAcceleration.html#a83543b502da8255ced01db85b58bde37">neml2::ProjectileAcceleration::ProjectileAcceleration</a></div><div class="ttdeci">ProjectileAcceleration(const OptionSet &amp;options)</div><div class="ttdef"><b>Definition</b> src1.cxx:46</div></div>
<div class="ttc" id="anamespaceneml2_html"><div class="ttname"><a href="namespaceneml2.html">neml2</a></div><div class="ttdef"><b>Definition</b> DiagnosticsInterface.cxx:29</div></div>
</div><!-- fragment --><p> NEML2 will look for an input option named "velocity" and declare a vector-valued input variable with the user-specified variable name. Similarly, another input option named "acceleration" will be used to declare a vector-valued output variable.</p>
<h1><a class="anchor" id="autotoc_md74"></a>
Parameter declaration</h1>
<p>Parameter (and buffer) declaration is semantically similarly to variable declaration.</p><ul>
<li><a class="el" href="classneml2_1_1ParameterStore.html#ac44196489c29d0a5f8e1c6d6399d6b4e" title="Declare a parameter.">neml2::Model::declare_parameter</a> is used to declare parameters, and</li>
<li><a class="el" href="classneml2_1_1BufferStore.html#a71f1b9a304f24158c1c50fd7bf39dbba" title="Declare a buffer.">neml2::Model::declare_buffer</a> is used to declare buffers.</li>
</ul>
<p>Recall that both parameters and buffers "travel with the model", meaning that when a model is sent to a different device, so are its parameters and buffers. The difference is that parameters are <em>trainable</em>. Therefore, in our example, we'd like to treat the dynamic viscosity as a trainable parameter and the gravitational acceleration as a buffer.</p>
<p>First, create the corresponding members in the class: </p><div class="fragment"><div class="line"><span class="comment">// Gravitational acceleration (parameter)</span></div>
<div class="line"><span class="keyword">const</span> Vec &amp; _g;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dynamic viscosity of the medium (parameter)</span></div>
<div class="line"><span class="keyword">const</span> Scalar &amp; _mu;</div>
</div><!-- fragment --><p> Then, call the declaration methods in the constructor, i.e. </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line"><a class="code hl_function" href="classneml2_1_1ProjectileAcceleration.html#a83543b502da8255ced01db85b58bde37">ProjectileAcceleration::ProjectileAcceleration</a>(<span class="keyword">const</span> OptionSet &amp; options)</div>
<div class="line">  : Model(options),</div>
<div class="line">    _v(declare_input_variable&lt;Vec&gt;(<span class="stringliteral">&quot;velocity&quot;</span>)),</div>
<div class="line">    _a(declare_output_variable&lt;Vec&gt;(<span class="stringliteral">&quot;acceleration&quot;</span>)),</div>
<div class="line">    _g(declare_buffer&lt;Vec&gt;(<span class="stringliteral">&quot;g&quot;</span>, <span class="stringliteral">&quot;gravitational_acceleration&quot;</span>)),</div>
<div class="line">    _mu(declare_parameter&lt;Scalar&gt;(<span class="stringliteral">&quot;mu&quot;</span>, <span class="stringliteral">&quot;dynamic_viscosity&quot;</span>))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The first argument of the parameter/buffer declaration method takes a string specifying the name of the parameter/buffer used internally. These names will then become the "handles" for retrieving and updating parameter/buffer values.</p>
<p>NEML2 will look for input options named "gravitational_acceleration" and "dynamic_viscosity" and declare the corresponding parameter and buffer.</p>
<h1><a class="anchor" id="autotoc_md75"></a>
Model inspection</h1>
<p>Once all arguments are successfully declared, the <em>structure</em> of the model is determined. NEML2 handles the allocation and arrangement of variables, parameters, buffers, and their underlying tensors. The structure of the model can be inspected by printing out the summary: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  set_default_dtype(kFloat64);</div>
<div class="line">  <span class="keyword">auto</span> model = load_model(<span class="stringliteral">&quot;input.i&quot;</span>, <span class="stringliteral">&quot;accel&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; *model &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Name:       accel</div>
<div class="line">Input:      state/v [Vec]</div>
<div class="line">Output:     state/a [Vec]</div>
<div class="line">Parameters: mu [Scalar][Double][cpu]</div>
<div class="line">Buffers:    g [Vec][Double][cpu]</div>
</div><!-- fragment --><div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="tutorials-extension-connection-to-input-files.html">Connection to input files</a>   </td><td class="markdownTableBodyRight"><a class="el" href="tutorials-extension-the-forward-operator.html">The forward operator</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
