<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.16.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Contributing</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('tutorials-contributing.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Contributing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_build_2doc_2content_2tutorials_2contributing"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md72"></a>
Model development</h1>
<p>Although NEML2 comes with a large collection of modular building blocks for composing material models, it is sometimes necessary to write your own material models (and integrate them with existing NEML2 models). The <a class="el" href="tutorials-extension.html" title="Extension">extension</a> tutorial set demonstrates how a custom model can be implemented within the NEML2 framework and provides an in-depth explanation for each step in the development process.</p>
<h1 class="doxsection"><a class="anchor" id="testing-cpp"></a>
C++ backend</h1>
<p>By default when <span class="tt">NEML2_TESTS</span> is set to <span class="tt">ON</span>, three test suites are built under the specified build directory:</p>
<ul>
<li><span class="tt">tests/unit/unit_tests</span>: Collection of tests to ensure individual objects are working correctly.</li>
<li><span class="tt">tests/regression/regression_tests</span>: Collection of tests to avoid regression.</li>
<li><span class="tt">tests/verification/verification_tests</span>: Collection of verification problems.</li>
</ul>
<p>For Visual Studio Code users, the <a href="https://github.com/matepek/vscode-catch2-test-adapter">C++ TestMate</a> extension can be used to automatically discover and run tests.</p>
<p>When <span class="tt">NEML2_WORK_DISPATCHER</span> is set to <span class="tt">ON</span>, an additional test suite is built:</p>
<ul>
<li><span class="tt">test/dispatchers/dispatcher_tests</span>: Collection of unit tests for the work dispatcher.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="testing-catch-tests"></a>
Catch tests</h2>
<p>A Catch test refers to a test directly written in C++ source code within the Catch2 framework. It offers the highest level of flexibility, but requires more effort to set up. To understand how a Catch2 test works, please refer to the <a href="https://github.com/catchorg/Catch2/blob/v2.x/docs/tutorial.md">official Catch2 documentation</a>.</p>
<h2 class="doxsection"><a class="anchor" id="testing-unit-tests"></a>
Unit tests</h2>
<p>A model unit test examines the outputs of a <span class="tt">Model</span> given a predefined set of inputs. Model unit tests can be directly designed using the input file syntax with the <span class="tt">ModelUnitTest</span> type. A variety of checks can be turned on and off based on input file options. To list a few: <span class="tt">check_first_derivatives</span> compares the implemented first order derivatives of the model against finite-differencing results, and the test is marked as passing only if the two derivatives are within tolerances specified with <span class="tt">derivative_abs_tol</span> and <span class="tt">derivative_rel_tol</span>.</p>
<p>All input files for model unit tests should be stored inside <span class="tt">tests/unit/models</span>. Every input file with the <span class="tt">.i</span> extension will be automatically discovered and executed. To run all the model unit tests, use the following commands </p><div class="fragment"><div class="line">./build/dev/unit/unit_tests models</div>
</div><!-- fragment --><p>To run a specific model unit test, use the <span class="tt">-c</span> command line option followed by the relative location of the input file, i.e. </p><div class="fragment"><div class="line">./build/dev/unit/unit_tests models -c solid_mechanics/LinearIsotropicElasticity.i</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="testing-regression-tests"></a>
Regression tests</h2>
<p>A model regression test runs a <span class="tt">Model</span> using a user specified driver. The results are compared against a predefined reference (stored on the disk checked into the repository). The test passes only if the current results are the same as the predefined reference (again within specified tolerances). The regression tests ensure the consistency of implementations across commits. Currently, <span class="tt">TransientRegression</span> is the only supported type of regression test.</p>
<p>Each input file for model regression tests should be stored inside a separate folder inside <span class="tt">tests/regression</span>. Every input file with the <span class="tt">.i</span> extension will be automatically discovered and executed. To run all the model regression tests, use the <span class="tt">regression_tests</span> executable followed by the physics module, i.e. </p><div class="fragment"><div class="line">./build/dev/regression/regression_tests &quot;solid mechanics&quot;</div>
</div><!-- fragment --><p> To run a specific model regression test, use the <span class="tt">-c</span> command line option followed by the relative location of the input file, i.e. </p><div class="fragment"><div class="line">./build/dev/regression/regression_tests &quot;solid mechanics&quot; -c viscoplasticity/chaboche/model.i</div>
</div><!-- fragment --><p> Note that the regression test expects an option <span class="tt">reference</span> which specifies the relative location to the reference solution.</p>
<h2 class="doxsection"><a class="anchor" id="testing-verification-tests"></a>
Verification tests</h2>
<p>The model verification test is similar to the model regression test in terms of workflow. The difference is the a verification test defines the reference solution using NEML, the predecessor of NEML2. Since NEML was developed with strict software assurance, the verification tests ensure that the migration from NEML to NEML2 does not cause any regression in software quality.</p>
<p>Each input file for model verification tests should be stored inside a separate folder inside <span class="tt">tests/verification</span>. Every input file with the <span class="tt">.i</span> extension will be automatically discovered and executed. To run all the model verification tests, use the <span class="tt">verification_tests</span> executable followed by the physics module, i.e. </p><div class="fragment"><div class="line">../build/dev/verification/verification_tests &quot;solid mechanics&quot;</div>
</div><!-- fragment --><p>To run a specific model verification test, use the <span class="tt">-c</span> command line option followed by the relative location of the input file, i.e. </p><div class="fragment"><div class="line">./build/dev/verification/verification_tests &quot;solid mechanics&quot; -c chaboche/chaboche.i</div>
</div><!-- fragment --><p> The regression test compares variables (specified using the <span class="tt">variables</span> option) against reference values (specified using the <span class="tt">references</span> option). The reference variables can be read using input objects with type <span class="tt">VTestTimeSeries</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md73"></a>
Command-line arguments</h2>
<p>The above test suites, including unit tests, regression tests, verification tests, and dispatcher tests, support a variety of configuration options that can be controlled from the command line. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/command-line.md">Catch2 command line</a> documentation for a list of useful command-line options. In addition, NEML2 test suites additionally support the following options:</p><ul>
<li><span class="tt">-p</span>, <span class="tt">--path</span>: working directory. This argument is optional and is only needed when the default guessing mechanism fails to locate the test input files.</li>
<li><span class="tt">-d</span>, <span class="tt">--devices</span>: list of additional (non-CPU) devices to test.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md74"></a>
Python package</h1>
<h2 class="doxsection"><a class="anchor" id="testing-python"></a>
Setup</h2>
<p>A collection of tests are available under <span class="tt">python/tests</span> to ensure the NEML2 Python package is working correctly. For Visual Studio Code users, the <a href="https://github.com/Microsoft/vscode-python">Python</a> extension can be used to automatically discover and run tests. In the extension settings, the "Pytest Enabled" variable shall be set to true. In addition, "pytestArgs" shall provide the location of tests, i.e. "${workspaceFolder}/python/tests". The <span class="tt">settings.json</span> file shall contain the following entries: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;python.testing.pytestEnabled&quot;: true,</div>
<div class="line">  &quot;python.testing.pytestArgs&quot;: [</div>
<div class="line">    &quot;${workspaceFolder}/python/tests&quot;</div>
<div class="line">  ],</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the Python bindings are built but are not installed to the site-packages directory (i.e. during development), pytest will not be able to import the neml2 package unless the environment variable <span class="tt">PYTHONPATH</span> is modified according to the specified build directory. For Visual Studio Code users, create a <span class="tt">.env</span> file in the repository's root and include an entry <span class="tt">PYTHONPATH=build/dev/python</span> (assuming the build directory is <span class="tt">build/dev</span> which is the default from CMake presets), and the Python extension will be able to import the NEML2 Python package.</p>
<h2 class="doxsection"><a class="anchor" id="testing-pytest"></a>
pytest</h2>
<p>The Python tests use the <a href="https://docs.pytest.org/en/stable/index.html">pytest</a> framework. To run tests using commandline, invoke <span class="tt">pytest</span> with the correct <span class="tt">PYTHONPATH</span>, i.e.</p>
<div class="fragment"><div class="line">PYTHONPATH=build/dev/python pytest python/tests</div>
</div><!-- fragment --><p>To run a specific test case, use</p>
<div class="fragment"><div class="line">PYTHONPATH=build/dev/python pytest &quot;python/tests/test_Model.py::test_forward&quot;</div>
</div><!-- fragment --><p> which runs the function named <span class="tt">test_forward</span> defined in the <span class="tt">python/tests/test_Model.py</span> file.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md75"></a>
Documentation</h1>
<p>It is of paramount importance to write documentation as the library is being developed. While NEML2 supports both Doxygen-style in-code documentation mechanisms and runtime syntax documentation mechanisms, it is still sometimes necessary to write standalone, self-contained documentation.</p>
<p>To this end, the "dev" configure preset and the "dev-doc" build preset (see <a class="el" href="build-customization.html" title="Build Customization">build customization</a>) can be used to generate and render the documentation locally: </p><div class="fragment"><div class="line">cmake --preset dev -S .</div>
<div class="line">cmake --build --preset dev-doc</div>
</div><!-- fragment --><p> Once the documentation is built, the site can be previewed locally in any browser that supports static HTML, i.e. </p><div class="fragment"><div class="line">firefox build/dev/doc/build/html/index.html</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md76"></a>
Code formatting and static analysis</h1>
<p>The C++ source code is formatted using <span class="tt">clang-format</span>. A <span class="tt">.clang-format</span> file is provided at the repository root specifying the formatting requirements. When using an IDE providing plugins or extensions to format C++ source code, it is important to</p><ol type="1">
<li>Point the plugin/extension to use the <span class="tt">.clang-format</span> file located at NEML2's repository root.</li>
<li>Associate file extensions <span class="tt">.h</span> and <span class="tt">.cxx</span> with C++.</li>
</ol>
<p>The Python scripts must be formatted using <span class="tt">black</span>. Formatting requirements are specified under the <span class="tt">[black]</span> section in <span class="tt">pyproject.toml</span>. All pull requests will be run through <span class="tt">clang-format</span> and <span class="tt">black</span> to ensure formatting consistency.</p>
<p>The "cc" preset (or the <span class="tt">CMAKE_EXPORT_COMPILE_COMMANDS</span> configure option) can be used to generate the compilation database <span class="tt">compile_commands.json</span>. A symbolic link to <span class="tt">compile_commands.json</span> will be created at the project root. The compilation database is needed by many static analysis tools. Visual Studio Code users are encouraged to use the <a href="https://github.com/clangd/vscode-clangd">clangd</a> extension. For C++ linting, a <span class="tt">.clang-tidy</span> file is provided at the repository root to specify expected checks. Python linting is not currently enforced. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
