<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Indexing</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorials-tensors-indexing.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Indexing</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md134">Batch versus base indexing</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md135">Single element indexing</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md136">Slicing</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md137">Dimensional indexing tools</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_content_2tutorials_2tensors_2indexing_2main"></a></p>
<p>Related reading:</p><ul>
<li>NumPy manual <a href="https://numpy.org/doc/2.2/user/basics.indexing.html">Indexing on ndarrays</a></li>
<li>PyTorch documentation <a href="https://pytorch.org/cppdocs/notes/tensor_indexing.html">Tensor Indexing API</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md134"></a>
Batch versus base indexing</h1>
<p>NEML2 tensor indexing works much in the same way as in NumPy and PyTorch. We also offer a simple one-to-one translation between C++ and Python tensor indexing API. The major difference between indexing (batched) NEML2 tensor and indexing tensors in PyTorch or N-D arrays in NumPy is that <b>most indexing APIs have two variants &ndash; one for indexing batch dimensions and the other for indexing base dimensions</b>.</p>
<h1><a class="anchor" id="autotoc_md135"></a>
Single element indexing</h1>
<p>Single element indexing works exactly like that for indexing flat containers such as vectors, arrays, lists, etc. The indexing is 0-based and accepts negative integers (for reverse indexing).</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (; 5)</span></div>
<div class="line">  <span class="keyword">auto</span> a = <a class="code hl_function" href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">Tensor::create</a>({3, 4, 5, 6, 7}, 0);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[2] = &quot;</span> &lt;&lt; a.base_index({2}).item&lt;Real&gt;() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[-1] = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.base_index({-1}).item&lt;Real&gt;() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[-2] = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.base_index({-2}).item&lt;Real&gt;() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (4;)</span></div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a80d125ed558bdb7fe69c75ac9a674a54">b</a> = <a class="code hl_function" href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">Tensor::create</a>({7, 6, 5, 4}, 1);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;b.batch[2] = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a80d125ed558bdb7fe69c75ac9a674a54">b</a>.batch_index({2}).item&lt;Real&gt;() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;b.batch[-1] = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a80d125ed558bdb7fe69c75ac9a674a54">b</a>.batch_index({-1}).item&lt;Real&gt;() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;b.batch[-2] = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a80d125ed558bdb7fe69c75ac9a674a54">b</a>.batch_index({-2}).item&lt;Real&gt;() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1Tensor_html_a4dd5f54c9160b1cf4df26e88fba6dcc3"><div class="ttname"><a href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">neml2::Tensor::create</a></div><div class="ttdeci">static Tensor create(TensorDataContainer data, const TensorOptions &amp;options=default_tensor_options())</div><div class="ttdoc">Arbitrary (unbatched) tensor from a nested container.</div><div class="ttdef"><b>Definition</b> Tensor.cxx:77</div></div>
<div class="ttc" id="anamespaceneml2_1_1crystallography_1_1crystal__symmetry__operators_html_a395e2cc5edd48653ef7fcd5c455ee6ab"><div class="ttname"><a href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">neml2::crystallography::crystal_symmetry_operators::a</a></div><div class="ttdeci">constexpr Real a</div><div class="ttdef"><b>Definition</b> crystallography.h:36</div></div>
<div class="ttc" id="anamespaceneml2_1_1crystallography_1_1crystal__symmetry__operators_html_a80d125ed558bdb7fe69c75ac9a674a54"><div class="ttname"><a href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a80d125ed558bdb7fe69c75ac9a674a54">neml2::crystallography::crystal_symmetry_operators::b</a></div><div class="ttdeci">constexpr Real b</div><div class="ttdef"><b>Definition</b> crystallography.h:37</div></div>
<div class="ttc" id="anamespaceneml2_html"><div class="ttname"><a href="namespaceneml2.html">neml2</a></div><div class="ttdef"><b>Definition</b> DiagnosticsInterface.cxx:30</div></div>
<div class="ttc" id="anamespaceneml2_html_a16c96ec35672a72196d72131d3f5f8c3"><div class="ttname"><a href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">neml2::kFloat64</a></div><div class="ttdeci">constexpr auto kFloat64</div><div class="ttdef"><b>Definition</b> types.h:53</div></div>
<div class="ttc" id="anamespaceneml2_html_a3c266b437e28eb7adec97c12b9a7e7d2"><div class="ttname"><a href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">neml2::set_default_dtype</a></div><div class="ttdeci">void set_default_dtype(Dtype dtype)</div><div class="ttdef"><b>Definition</b> defaults.cxx:32</div></div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.base[2] = 5</div>
<div class="line">a.base[-1] = 7</div>
<div class="line">a.base[-2] = 6</div>
<div class="line"> </div>
<div class="line">b.batch[2] = 5</div>
<div class="line">b.batch[-1] = 4</div>
<div class="line">b.batch[-2] = 5</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> torch</div>
<div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Tensor</div>
<div class="line"> </div>
<div class="line">torch.set_default_dtype(torch.double)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a tensor with shape (; 5)</span></div>
<div class="line">a = Tensor(torch.tensor([3, 4, 5, 6, 7]), 0)</div>
<div class="line">print(<span class="stringliteral">&quot;a.base[2] =&quot;</span>, a.base[2].item())</div>
<div class="line">print(<span class="stringliteral">&quot;a.base[-1] =&quot;</span>, a.base[-1].item())</div>
<div class="line">print(<span class="stringliteral">&quot;a.base[-2] =&quot;</span>, a.base[-2].item())</div>
<div class="line">print()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># reate a tensor with shape (4;)</span></div>
<div class="line">b = Tensor(torch.tensor([7, 6, 5, 4]), 1)</div>
<div class="line">print(<span class="stringliteral">&quot;b.batch[2] =&quot;</span>, b.batch[2].item())</div>
<div class="line">print(<span class="stringliteral">&quot;b.batch[-1] =&quot;</span>, b.batch[-1].item())</div>
<div class="line">print(<span class="stringliteral">&quot;b.batch[-2] =&quot;</span>, b.batch[-2].item())</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.base[2] = 5</div>
<div class="line">a.base[-1] = 7</div>
<div class="line">a.base[-2] = 6</div>
<div class="line"> </div>
<div class="line">b.batch[2] = 5</div>
<div class="line">b.batch[-1] = 4</div>
<div class="line">b.batch[-2] = 5</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><p>Single element indexing can be used to index multidimensional tensors, in which case each integer corresponds to one dimension, counting from the leading (leftmost) dimension onward. If the number of indices is smaller than the number of dimensions, a view of the subdimensional tensor is returned.</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (2, 2 ; 3, 1)</span></div>
<div class="line">  <span class="keyword">auto</span> a = <a class="code hl_function" href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">Tensor::create</a>({{{{1}, {2}, {3}}, {{4}, {5}, {6}}},</div>
<div class="line">                           {{{-1}, {-2}, {-3}}, {{-4}, {-5}, {-6}}}}, 2);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Single element indexing along batch dimensions</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[1, 0] = \n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({1, 0}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[0] = \n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({0}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Single element indexing along base dimensions</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[2, 0] = \n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.base_index({2, 0}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[0] = \n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.base_index({1}) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[1, 0] = </div>
<div class="line">-1</div>
<div class="line">-2</div>
<div class="line">-3</div>
<div class="line">[ CPUDoubleType{3,1} ]</div>
<div class="line"> </div>
<div class="line">a.batch[0] = </div>
<div class="line">(1,.,.) = </div>
<div class="line">  1</div>
<div class="line">  2</div>
<div class="line">  3</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line">  4</div>
<div class="line">  5</div>
<div class="line">  6</div>
<div class="line">[ CPUDoubleType{2,3,1} ]</div>
<div class="line"> </div>
<div class="line">a.base[2, 0] = </div>
<div class="line"> 3  6</div>
<div class="line">-3 -6</div>
<div class="line">[ CPUDoubleType{2,2} ]</div>
<div class="line"> </div>
<div class="line">a.base[0] = </div>
<div class="line">(1,.,.) = </div>
<div class="line">  2</div>
<div class="line">  5</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line"> -2</div>
<div class="line"> -5</div>
<div class="line">[ CPUDoubleType{2,2,1} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> torch</div>
<div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Tensor</div>
<div class="line"> </div>
<div class="line">torch.set_default_dtype(torch.double)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a tensor with shape (2, 2 ; 3, 1)</span></div>
<div class="line">a = Tensor(torch.tensor([[[[1], [2], [3]], [[4], [5], [6]]],</div>
<div class="line">                         [[[-1], [-2], [-3]], [[-4], [-5], [-6]]]]), 2)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Single element indexing along batch dimensions</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[1, 0] =&quot;</span>)</div>
<div class="line">print(a.batch[1, 0], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[0] =&quot;</span>)</div>
<div class="line">print(a.batch[0], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Single element indexing along base dimensions</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.base[2, 0] =&quot;</span>)</div>
<div class="line">print(a.base[2, 0], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.base[1] =&quot;</span>)</div>
<div class="line">print(a.base[1])</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[1, 0] =</div>
<div class="line">-1</div>
<div class="line">-2</div>
<div class="line">-3</div>
<div class="line">[ CPULongType{3,1} ]</div>
<div class="line">&lt;Tensor of shape [][3, 1]&gt; </div>
<div class="line"> </div>
<div class="line">a.batch[0] =</div>
<div class="line">(1,.,.) = </div>
<div class="line">  1</div>
<div class="line">  2</div>
<div class="line">  3</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line">  4</div>
<div class="line">  5</div>
<div class="line">  6</div>
<div class="line">[ CPULongType{2,3,1} ]</div>
<div class="line">&lt;Tensor of shape [2][3, 1]&gt; </div>
<div class="line"> </div>
<div class="line">a.base[2, 0] =</div>
<div class="line"> 3  6</div>
<div class="line">-3 -6</div>
<div class="line">[ CPULongType{2,2} ]</div>
<div class="line">&lt;Tensor of shape [2, 2][]&gt; </div>
<div class="line"> </div>
<div class="line">a.base[1] =</div>
<div class="line">(1,.,.) = </div>
<div class="line">  2</div>
<div class="line">  5</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line"> -2</div>
<div class="line"> -5</div>
<div class="line">[ CPULongType{2,2,1} ]</div>
<div class="line">&lt;Tensor of shape [2, 2][1]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><h1><a class="anchor" id="autotoc_md136"></a>
Slicing</h1>
<p>NEML2 supports the same slicing rules as in NumPy and PyTorch. A slice takes the form of </p><div class="fragment"><div class="line">start:stop:step</div>
</div><!-- fragment --><p> where <code>start</code>, <code>stop</code>, and <code>step</code> are integers representing the starting index, ending index, and the striding of the sliced tensor view. All of these integers are optional when constructing a slice: <code>start</code> default to 0, <code>stop</code> default to \(\infty\) (i.e., <code>std::numeric_limits&lt;Size&gt;::max()</code>), and <code>step</code> default to 1. Note that <code>step</code> must be positive.</p>
<p>It is best to learn slicing from examples. Below are equivalent C++ and Python codes applying the same set of slicing operations on the same tensor.</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Scalar.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2_1_1indexing.html">indexing</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (20;)</span></div>
<div class="line">  <span class="keyword">auto</span> a0 = <a class="code hl_function" href="classneml2_1_1PrimitiveTensor.html#ab49f3fdd246f714b967d992668425ac2">Scalar::full</a>(0.0);</div>
<div class="line">  <span class="keyword">auto</span> a1 = <a class="code hl_function" href="classneml2_1_1PrimitiveTensor.html#ab49f3fdd246f714b967d992668425ac2">Scalar::full</a>(19.0);</div>
<div class="line">  <span class="keyword">auto</span> a = <a class="code hl_function" href="group__tensor__creation.html#gab9805449dc0970401c00fd71495c1b5d">Scalar::linspace</a>(a0, a1, 20);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Basic syntax: start:stop:step&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[5:17:2] =\n&quot;</span> &lt;&lt; a.batch_index({Slice(5, 17, 2)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Negative start and stop are counted backward&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[-15:-3:2] =\n&quot;</span> &lt;&lt; a.batch_index({Slice(-15, -3, 2)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;start default to 0&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[:17:3] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(None, 17, 2)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;stop default to &#39;consuming all remaining elements&#39;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[12::2] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(12, None, 2)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;step default to 1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[3:6:] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(3, 6, None)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Trailing colon(s) can be omitted&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[3:6] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(3, 6)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[17:] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(17)}) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The default is therefore equivalent to slicing the entire dimension&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[:] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice()}) &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1PrimitiveTensor_html_ab49f3fdd246f714b967d992668425ac2"><div class="ttname"><a href="classneml2_1_1PrimitiveTensor.html#ab49f3fdd246f714b967d992668425ac2">neml2::PrimitiveTensor&lt; Scalar &gt;::full</a></div><div class="ttdeci">static Scalar full(Real init, const TensorOptions &amp;options=default_tensor_options())</div><div class="ttdef"><b>Definition</b> PrimitiveTensor.h:211</div></div>
<div class="ttc" id="agroup__tensor__creation_html_gab9805449dc0970401c00fd71495c1b5d"><div class="ttname"><a href="group__tensor__creation.html#gab9805449dc0970401c00fd71495c1b5d">neml2::TensorBase&lt; Scalar &gt;::linspace</a></div><div class="ttdeci">static Scalar linspace(const Scalar &amp;start, const Scalar &amp;end, Size nstep, Size dim=0)</div><div class="ttdef"><b>Definition</b> TensorBaseImpl.h:102</div></div>
<div class="ttc" id="anamespaceneml2_1_1indexing_html"><div class="ttname"><a href="namespaceneml2_1_1indexing.html">neml2::indexing</a></div><div class="ttdef"><b>Definition</b> types.h:75</div></div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">Basic syntax: start:stop:step</div>
<div class="line">a.batch[5:17:2] =</div>
<div class="line">  5</div>
<div class="line">  7</div>
<div class="line">  9</div>
<div class="line"> 11</div>
<div class="line"> 13</div>
<div class="line"> 15</div>
<div class="line">[ CPUDoubleType{6} ]</div>
<div class="line"> </div>
<div class="line">Negative start and stop are counted backward</div>
<div class="line">a.batch[-15:-3:2] =</div>
<div class="line">  5</div>
<div class="line">  7</div>
<div class="line">  9</div>
<div class="line"> 11</div>
<div class="line"> 13</div>
<div class="line"> 15</div>
<div class="line">[ CPUDoubleType{6} ]</div>
<div class="line"> </div>
<div class="line">start default to 0</div>
<div class="line">a.batch[:17:3] =</div>
<div class="line">  0</div>
<div class="line">  2</div>
<div class="line">  4</div>
<div class="line">  6</div>
<div class="line">  8</div>
<div class="line"> 10</div>
<div class="line"> 12</div>
<div class="line"> 14</div>
<div class="line"> 16</div>
<div class="line">[ CPUDoubleType{9} ]</div>
<div class="line"> </div>
<div class="line">stop default to &#39;consuming all remaining elements&#39;</div>
<div class="line">a.batch[12::2] =</div>
<div class="line"> 12</div>
<div class="line"> 14</div>
<div class="line"> 16</div>
<div class="line"> 18</div>
<div class="line">[ CPUDoubleType{4} ]</div>
<div class="line"> </div>
<div class="line">step default to 1</div>
<div class="line">a.batch[3:6:] =</div>
<div class="line"> 3</div>
<div class="line"> 4</div>
<div class="line"> 5</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line"> </div>
<div class="line">Trailing colon(s) can be omitted</div>
<div class="line">a.batch[3:6] =</div>
<div class="line"> 3</div>
<div class="line"> 4</div>
<div class="line"> 5</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line"> </div>
<div class="line">a.batch[17:] =</div>
<div class="line"> 17</div>
<div class="line"> 18</div>
<div class="line"> 19</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line"> </div>
<div class="line">The default is therefore equivalent to slicing the entire dimension</div>
<div class="line">a.batch[:] =</div>
<div class="line">  0</div>
<div class="line">  1</div>
<div class="line">  2</div>
<div class="line">  3</div>
<div class="line">  4</div>
<div class="line">  5</div>
<div class="line">  6</div>
<div class="line">  7</div>
<div class="line">  8</div>
<div class="line">  9</div>
<div class="line"> 10</div>
<div class="line"> 11</div>
<div class="line"> 12</div>
<div class="line"> 13</div>
<div class="line"> 14</div>
<div class="line"> 15</div>
<div class="line"> 16</div>
<div class="line"> 17</div>
<div class="line"> 18</div>
<div class="line"> 19</div>
<div class="line">[ CPUDoubleType{20} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Scalar</div>
<div class="line"><span class="keyword">import</span> torch</div>
<div class="line"> </div>
<div class="line">torch.set_default_dtype(torch.double)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a tensor with shape (20;)</span></div>
<div class="line">a0 = Scalar.full(0.0)</div>
<div class="line">a1 = Scalar.full(19.0)</div>
<div class="line">a = Scalar.linspace(a0, a1, 20)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;Basic syntax: start:stop:step&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[5:17:2] =&quot;</span>)</div>
<div class="line">print(a.batch[5:17:2], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;Negative start and stop are counted backward&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[-15:-3:2] =&quot;</span>)</div>
<div class="line">print(a.batch[-15:-3:2], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;start default to 0&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[:17:3] =&quot;</span>)</div>
<div class="line">print(a.batch[:17:3], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;stop default to &#39;consuming all remaining elements&#39;&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[12::2] =&quot;</span>)</div>
<div class="line">print(a.batch[12::2], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;step default to 1&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[3:6:] =&quot;</span>)</div>
<div class="line">print(a.batch[3:6:], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;Trailing colon(s) can be omitted&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[3:6] =&quot;</span>)</div>
<div class="line">print(a.batch[3:6], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[17:] =&quot;</span>)</div>
<div class="line">print(a.batch[17:], <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;The default is therefore equivalent to slicing the entire dimension&quot;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[:] =&quot;</span>)</div>
<div class="line">print(a.batch[:])</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">Basic syntax: start:stop:step</div>
<div class="line">a.batch[5:17:2] =</div>
<div class="line">  5</div>
<div class="line">  7</div>
<div class="line">  9</div>
<div class="line"> 11</div>
<div class="line"> 13</div>
<div class="line"> 15</div>
<div class="line">[ CPUDoubleType{6} ]</div>
<div class="line">&lt;Scalar of shape [6][]&gt; </div>
<div class="line"> </div>
<div class="line">Negative start and stop are counted backward</div>
<div class="line">a.batch[-15:-3:2] =</div>
<div class="line">  5</div>
<div class="line">  7</div>
<div class="line">  9</div>
<div class="line"> 11</div>
<div class="line"> 13</div>
<div class="line"> 15</div>
<div class="line">[ CPUDoubleType{6} ]</div>
<div class="line">&lt;Scalar of shape [6][]&gt; </div>
<div class="line"> </div>
<div class="line">start default to 0</div>
<div class="line">a.batch[:17:3] =</div>
<div class="line">  0</div>
<div class="line">  3</div>
<div class="line">  6</div>
<div class="line">  9</div>
<div class="line"> 12</div>
<div class="line"> 15</div>
<div class="line">[ CPUDoubleType{6} ]</div>
<div class="line">&lt;Scalar of shape [6][]&gt; </div>
<div class="line"> </div>
<div class="line">stop default to &#39;consuming all remaining elements&#39;</div>
<div class="line">a.batch[12::2] =</div>
<div class="line"> 12</div>
<div class="line"> 14</div>
<div class="line"> 16</div>
<div class="line"> 18</div>
<div class="line">[ CPUDoubleType{4} ]</div>
<div class="line">&lt;Scalar of shape [4][]&gt; </div>
<div class="line"> </div>
<div class="line">step default to 1</div>
<div class="line">a.batch[3:6:] =</div>
<div class="line"> 3</div>
<div class="line"> 4</div>
<div class="line"> 5</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line">&lt;Scalar of shape [3][]&gt; </div>
<div class="line"> </div>
<div class="line">Trailing colon(s) can be omitted</div>
<div class="line">a.batch[3:6] =</div>
<div class="line"> 3</div>
<div class="line"> 4</div>
<div class="line"> 5</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line">&lt;Scalar of shape [3][]&gt; </div>
<div class="line"> </div>
<div class="line">a.batch[17:] =</div>
<div class="line"> 17</div>
<div class="line"> 18</div>
<div class="line"> 19</div>
<div class="line">[ CPUDoubleType{3} ]</div>
<div class="line">&lt;Scalar of shape [3][]&gt; </div>
<div class="line"> </div>
<div class="line">The default is therefore equivalent to slicing the entire dimension</div>
<div class="line">a.batch[:] =</div>
<div class="line">  0</div>
<div class="line">  1</div>
<div class="line">  2</div>
<div class="line">  3</div>
<div class="line">  4</div>
<div class="line">  5</div>
<div class="line">  6</div>
<div class="line">  7</div>
<div class="line">  8</div>
<div class="line">  9</div>
<div class="line"> 10</div>
<div class="line"> 11</div>
<div class="line"> 12</div>
<div class="line"> 13</div>
<div class="line"> 14</div>
<div class="line"> 15</div>
<div class="line"> 16</div>
<div class="line"> 17</div>
<div class="line"> 18</div>
<div class="line"> 19</div>
<div class="line">[ CPUDoubleType{20} ]</div>
<div class="line">&lt;Scalar of shape [20][]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><p>Similar to single element indexing, slicing can also be used to index multidimensional tensors. When the number of slices is smaller than the number of dimensions, a view of the subdimensional tensor is returned.</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2_1_1indexing.html">indexing</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (3, 4; 2)</span></div>
<div class="line">  <span class="keyword">auto</span> a0 = <a class="code hl_function" href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">Tensor::create</a>({{0, 1}, {2, 3}, {4, 5}}, 1);</div>
<div class="line">  <span class="keyword">auto</span> a1 = <a class="code hl_function" href="classneml2_1_1Tensor.html#a4dd5f54c9160b1cf4df26e88fba6dcc3">Tensor::create</a>({{3, 4}, {5, 6}, {7, 8}}, 1);</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a> = <a class="code hl_function" href="group__tensor__creation.html#gab9805449dc0970401c00fd71495c1b5d">Tensor::linspace</a>(a0, a1, 4, 1);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[:2, -3:4] =\n&quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(None, 2), Slice(-3, 4)}) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[:2, -3:4] =</div>
<div class="line">(1,.,.) = </div>
<div class="line">  1  2</div>
<div class="line">  2  3</div>
<div class="line">  3  4</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line">  3  4</div>
<div class="line">  4  5</div>
<div class="line">  5  6</div>
<div class="line">[ CPUDoubleType{2,3,2} ]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> torch</div>
<div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Tensor</div>
<div class="line"> </div>
<div class="line">torch.set_default_dtype(torch.double)</div>
<div class="line"> </div>
<div class="line">a0 = Tensor(torch.tensor([[0, 1], [2, 3], [4, 5]]), 1)</div>
<div class="line">a1 = Tensor(torch.tensor([[3, 4], [5, 6], [7, 8]]), 1)</div>
<div class="line">a = Tensor.linspace(a0, a1, 4, 1)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[:2, -3:4] =&quot;</span>)</div>
<div class="line">print(a.batch[:2, -3:4])</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[:2, -3:4] =</div>
<div class="line">(1,.,.) = </div>
<div class="line">  1  2</div>
<div class="line">  2  3</div>
<div class="line">  3  4</div>
<div class="line"> </div>
<div class="line">(2,.,.) = </div>
<div class="line">  3  4</div>
<div class="line">  4  5</div>
<div class="line">  5  6</div>
<div class="line">[ CPUDoubleType{2,3,2} ]</div>
<div class="line">&lt;Tensor of shape [2, 3][2]&gt;</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><h1><a class="anchor" id="autotoc_md137"></a>
Dimensional indexing tools</h1>
<p>When indexing multidimensional tensors, having to specify the element index or slicing for each dimension would be cumbersome. To simplify multidimensional indexing, some special syntax and notations are reserved for inferring tensor shapes.</p>
<p>NEML2 currently supports two special symbols:</p><ul>
<li><code>Ellipsis</code> or <code>...</code> (only available in Python) is equivalent to one or multiple <code>Slice()</code> or <code>:</code> expanding the rest of the dimensions.</li>
<li><code>None</code> (when used as a index) is equivalent to NumPy's <code>newaxis</code> which unsqueezes a unit-length dimension at the specified place.</li>
</ul>
<p>Again, the use of these special symbols are best illustrated by examples.</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;torch/torch.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;neml2/tensors/Tensor.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a>;</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceneml2_1_1indexing.html">indexing</a>;</div>
<div class="line">  <a class="code hl_function" href="namespaceneml2.html#a3c266b437e28eb7adec97c12b9a7e7d2">set_default_dtype</a>(<a class="code hl_variable" href="namespaceneml2.html#a16c96ec35672a72196d72131d3f5f8c3">kFloat64</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a tensor with shape (5, 3, 1, 3; 1, 7, 8)</span></div>
<div class="line">  <span class="keyword">auto</span> a = <a class="code hl_class" href="classneml2_1_1Tensor.html">Tensor</a>(torch::rand({5, 3, 1, 3, 1, 7, 8}), 4);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Batch indexing with ellipsis</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[2:, ..., :].shape = &quot;</span> &lt;&lt; a.batch_index({Slice(2), Ellipsis, Slice()}).sizes() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Batch indexing with none</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[2:, :, :, None, :].shape = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Slice(2), Slice(), Slice(), None, Slice()}).sizes() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Batch indexing with both ellipsis and none</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.batch[..., None, :].shape = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.batch_index({Ellipsis, None, Slice()}).sizes() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Same rules apply to base indexing</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a.base[..., None, :].shape = &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceneml2_1_1crystallography_1_1crystal__symmetry__operators.html#a395e2cc5edd48653ef7fcd5c455ee6ab">a</a>.base_index({Ellipsis, None, Slice()}).sizes() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassneml2_1_1Tensor_html"><div class="ttname"><a href="classneml2_1_1Tensor.html">neml2::Tensor</a></div><div class="ttdef"><b>Definition</b> Tensor.h:46</div></div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[2:, ..., :].shape = [3, 3, 1, 3, 1, 7, 8]</div>
<div class="line">a.batch[2:, :, :, None, :].shape = [3, 3, 1, 1, 3, 1, 7, 8]</div>
<div class="line">a.batch[..., None, :].shape = [5, 3, 1, 1, 3, 1, 7, 8]</div>
<div class="line">a.base[..., None, :].shape = [5, 3, 1, 3, 1, 7, 1, 8]</div>
</div><!-- fragment --></li>
<li><p class="startli"><b class="tab-title">Python</b> </p><div class="fragment"><div class="line"><span class="keyword">import</span> torch</div>
<div class="line"><span class="keyword">from</span> neml2.tensors <span class="keyword">import</span> Tensor</div>
<div class="line"> </div>
<div class="line">torch.set_default_dtype(torch.double)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a tensor with shape (5, 3, 1, 3; 1, 7, 8)</span></div>
<div class="line">a = Tensor(torch.rand(5, 3, 1, 3, 1, 7, 8), 4)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Batch indexing with ellipsis</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[2:, ..., :].shape =&quot;</span>, a.batch[2:, ..., :].shape)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Batch indexing with none</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[2:, :, :, None, :].shape =&quot;</span>, a.batch[2:, :, :, <span class="keywordtype">None</span>, :].shape)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Batch indexing with both ellipsis and none</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.batch[..., None, :].shape =&quot;</span>, a.batch[..., <span class="keywordtype">None</span>, :].shape)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Same rules apply to base indexing</span></div>
<div class="line">print(<span class="stringliteral">&quot;a.base[..., None, :].shape =&quot;</span>, a.base[..., <span class="keywordtype">None</span>, :].shape)</div>
</div><!-- fragment --><p class="startli">Output: </p><div class="fragment"><div class="line">a.batch[2:, ..., :].shape = (3, 3, 1, 3, 1, 7, 8)</div>
<div class="line">a.batch[2:, :, :, None, :].shape = (3, 3, 1, 1, 3, 1, 7, 8)</div>
<div class="line">a.batch[..., None, :].shape = (5, 3, 1, 1, 3, 1, 7, 8)</div>
<div class="line">a.base[..., None, :].shape = (5, 3, 1, 3, 1, 7, 1, 8)</div>
</div><!-- fragment --></li>
</ul>
</div><div class="tabbed"></div><div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="tutorials-tensors-tensor-creation.html">Tensor creation</a>   </td><td class="markdownTableBodyRight"><a class="el" href="tutorials-tensors-tensor-view.html">Tensor view</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
