<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Tensor types</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorials-tensors-tensor-types.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tensor types</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md151">Batching</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md152">Why batching?</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md153">Tensor types</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_content_2tutorials_2tensors_2tensor__types_2main"></a></p>
<p>NEML2 tensors are extremely similar to the tensor type provided by its default backend ATen. In fact, all NEML2 tensors inherit from <code>at::Tensor</code>, <em>the</em> tensor type from ATen. What's different from ATen is that the NEML2 tensor library provides the following enhancements:</p><ul>
<li>Explicit distinction between <em>batch</em> and <em>base</em> dimensions</li>
<li><b>Primitive</b> tensor types commonly used in traditional scientific computing</li>
<li>Commonly used math operators and functions for primitive tensor types</li>
</ul>
<h1><a class="anchor" id="autotoc_md151"></a>
Batching</h1>
<p>Given a general, \(n\)-dimensional tensor (or array), its shape is usually denoted using a tuple consisting of sizes of each of its dimension, i.e.   </p><p class="formulaDsp">
\[
  (d_0, d_1, d_2, ..., d_i, ..., d_{n-2}, d_{n-1}), \quad i = 0, 1, 2, ..., n-1,
\]
</p>
<p> where \(d_i\) is the number of components along dimension \(i\).</p>
<p>In NEML2, we explicitly introduce the concept of batching such that the shape of a \(n\)-dimensional tensor may now be denoted (with a slight abuse of notation) as     </p><p class="formulaDsp">
\begin{align*}
  (c_0, c_1, c_2, ..., c_i, ..., c_{n_b-2}, c_{n_b-1}\textcolor{blue}{;} d_0, d_1, d_2, ..., d_j, ..., d_{n-n_b-2}, d_{n-n_b-1}), \\
  i = 0, 1, 2, ..., n_b-1, \\
  j = 0, 1, 2, ..., n-n_b-1,
\end{align*}
</p>
<p> where \(n_b \geq 0\) is the number of batch dimensions, \(c_i\) is the number of components along each batch dimension, and \(d_j\) is the number of components along each base dimension. In NEML2's notation, a separator \(;\) is used to delimit batch and base sizes. Tensor shapes always have one and only one \(;\) delimiter.</p>
<p>For example, given a tensor of shape   </p><p class="formulaDsp">
\[
  (3, 100, 5, 13, 2),
\]
</p>
<p> we could assign it a batch dimension of 3, and the resulting shape of the batched tensor becomes   </p><p class="formulaDsp">
\[
  (3, 100, 5; 13, 2).
\]
</p>
<p> Similarly, if the batch dimension is 0 or 5, the resulting shape would become    </p><p class="formulaDsp">
\begin{align*}
  (; 3, 100, 5, 13, 2), \\
  (3, 100, 5, 13, 2;).
\end{align*}
</p>
<p> It is valid for the \(;\) delimiter to appear at the beginning or the end of the shape tuple. If it appears at the beginning it means that tensor has no batch dimensions. If it appears at the end it means the tensor is a batched scalar.</p>
<h1><a class="anchor" id="autotoc_md152"></a>
Why batching?</h1>
<p>The definition of batching is fairly straightforward. However, fair question to ask is "why another layer of abstraction on top of the regular tensor shape definition"? Let's briefly consider the high-level motivation behind this design choice.</p>
<p><b>Shape ambiguity</b>: Consider a tensor of shape \( (55, 100, 3, 3, 3, 3) \), it can be interpreted as</p><ul>
<li>a scalar with batch shape \( (55, 100, 3, 3, 3, 3) \),</li>
<li>a 3-vector with batch shape \( (55, 100, 3, 3, 3) \),</li>
<li>a second order tensor with batch shape \( (55, 100, 3, 3) \),</li>
<li>a third order tensor with batch shape \( (55, 100, 3) \), or</li>
<li>a fourth order tensor with batch shape \( (55, 100) \).</li>
</ul>
<p>Such ambiguity can be avoided if the user consistently keeps track of batching throughout the lifetime of all related tensor operations, which is manageable in simple models but difficult to scale if the model grows in complexity. Therefore, in NEML2, we incorporate the management and propagation of this information directly in the tensor library, removing such overhead from user implementation.</p>
<p><b>Scalar broadcasting</b>: With more details to be covered in a <a class="el" href="tutorials-tensors-broadcasting.html">later tutorial</a> on broadcasting, explicit batching allows general broadcasting rules between scalar and other primitive tensor types.</p>
<p><b>Shape generalization</b>: As mentioned in the <a class="el" href="tutorials-models-just-in-time-compilation.html">tutorial</a> on JIT compilation, NEML2 supports tracing tensor operations into graphs. The PyTorch tracing engine does not support tracing operations on tensor shapes, and so users are left with two options:</p><ul>
<li>Trace the graph with example input variables having the same shape as real input variables to be used later on.</li>
<li>Re-trace the graph whenever any input variable has a different shape.</li>
</ul>
<p>The first option implies a potential memory bound at the stage of JIT compilation, and is difficult to guarantee in practice. The second option imposes a significant runtime overhead whenever re-tracing is necessary.</p>
<p>With explicit batching, NEML2 is able to generate <em>batch-generalizable</em> graphs. As long as the batch dimensions of the input variables remain unchanged, the same traced graph can be reused without re-tracing.</p>
<h1><a class="anchor" id="autotoc_md153"></a>
Tensor types</h1>
<p><a class="el" href="classneml2_1_1Tensor.html">neml2::Tensor</a> is the general-purpose tensor type whose base shape can be modified at runtime.</p>
<p>In addition, NEML2 offers a rich collection of primitive tensor types whose base shapes are static, i.e., remain fixed at runtime. Currently implemented tensor types are summarized in the following table.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Tensor type   </th><th class="markdownTableHeadLeft">Base shape   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1Tensor.html">Tensor</a>   </td><td class="markdownTableBodyLeft">Dynamic   </td><td class="markdownTableBodyLeft">General-purpose tensor with dynamic base shape    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1Scalar.html">Scalar</a>   </td><td class="markdownTableBodyLeft">\(()\)   </td><td class="markdownTableBodyLeft">Rank-0 tensor, i.e. scalar    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1Vec.html">Vec</a>   </td><td class="markdownTableBodyLeft">\((3)\)   </td><td class="markdownTableBodyLeft">Rank-1 tensor, i.e. vector    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1R2.html">R2</a>   </td><td class="markdownTableBodyLeft">\((3,3)\)   </td><td class="markdownTableBodyLeft">Rank-2 tensor    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1SR2.html">SR2</a>   </td><td class="markdownTableBodyLeft">\((6)\)   </td><td class="markdownTableBodyLeft">Symmetric rank-2 tensor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1WR2.html">WR2</a>   </td><td class="markdownTableBodyLeft">\((3)\)   </td><td class="markdownTableBodyLeft">Skew-symmetric rank-2 tensor    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1R3.html">R3</a>   </td><td class="markdownTableBodyLeft">\((3,3,3)\)   </td><td class="markdownTableBodyLeft">Rank-3 tensor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1SFR3.html">SFR3</a>   </td><td class="markdownTableBodyLeft">\((6,3)\)   </td><td class="markdownTableBodyLeft">Rank-3 tensor with symmetry on base dimensions 0 and 1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1R4.html">R4</a>   </td><td class="markdownTableBodyLeft">\((3,3,3,3)\)   </td><td class="markdownTableBodyLeft">Rank-4 tensor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1SFFR4.html">SFFR4</a>   </td><td class="markdownTableBodyLeft">\((6,3,3\))   </td><td class="markdownTableBodyLeft">Rank-4 tensor with symmetry on base dimensions 0 and 1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1WFFR4.html">WFFR4</a>   </td><td class="markdownTableBodyLeft">\((3,3,3\))   </td><td class="markdownTableBodyLeft">Rank-4 tensor with skew symmetry on base dimensions 0 and 1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1SSR4.html">SSR4</a>   </td><td class="markdownTableBodyLeft">\((6,6)\)   </td><td class="markdownTableBodyLeft">Rank-4 tensor with minor symmetry    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1SWR4.html">SWR4</a>   </td><td class="markdownTableBodyLeft">\((6,3)\)   </td><td class="markdownTableBodyLeft">Rank-4 tensor with minor symmetry then skew symmetry    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1WSR4.html">WSR4</a>   </td><td class="markdownTableBodyLeft">\((3,6)\)   </td><td class="markdownTableBodyLeft">Rank-4 tensor with skew symmetry then minor symmetry    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1WWR4.html">WWR4</a>   </td><td class="markdownTableBodyLeft">\((3,3)\)   </td><td class="markdownTableBodyLeft">Rank-4 tensor with skew symmetry    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1Rot.html">Rot</a>   </td><td class="markdownTableBodyLeft">\((3)\)   </td><td class="markdownTableBodyLeft">Rotation tensor represented in the Rodrigues form    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1Quaternion.html">Quaternion</a>   </td><td class="markdownTableBodyLeft">\((4)\)   </td><td class="markdownTableBodyLeft">Quaternion    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="classneml2_1_1MillerIndex.html">MillerIndex</a>   </td><td class="markdownTableBodyLeft">\((3)\)   </td><td class="markdownTableBodyLeft">Crystal direction or lattice plane represented as Miller indices   </td></tr>
</table>
<p>All primitive tensor types can be declared as variables, parameters, and buffers in a model.</p>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="tutorials-tensors.html">Tensors</a>   </td><td class="markdownTableBodyRight"><a class="el" href="tutorials-tensors-tensor-creation.html">Tensor creation</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
