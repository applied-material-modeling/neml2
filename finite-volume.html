<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.16.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: Finite Volume Transport Physics</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('finite-volume.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Finite Volume Transport Physics </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md23">Finite volume discretization </a>
    <ul>
      <li class="level2">
        <a href="#autotoc_md24">Cell-edge interpolation </a>
      </li>
      <li class="level2">
        <a href="#autotoc_md25">Gradients </a>
      </li>
      <li class="level2">
        <a href="#autotoc_md26">Advective flux </a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#autotoc_md27">Finite volume transport model building blocks </a>
  </li>
  <li class="level1">
    <a href="#autotoc_md28">Example: combined advection–diffusion–reaction </a>
  </li>
  <li class="level1">
    <a href="#autotoc_md29">Verification and regression tests </a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_build_2doc_2content_2physics_2finite__volume"></a></p>
<p>The finite volume transport physics module provides composable building blocks for solve 1D PDEs with finite volume methods. The models are designed for arbitrary batch dimensions and integrate with the standard NEML2 time integration and nonlinear solve infrastructure. The module could be used for arbitrary PDEs, but the provided examples and tests focus on 1D transport (advection-diffusion-reaction) PDEs.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Finite volume discretization</h1>
<p>We consider a conserved quantity \(u(x,t)\) with total flux \(J\) and reaction term \(R\):</p>
<p class="formulaDsp">
\[  u_t + J_x = R,
\]
</p>
<p>over a domain \(\Omega \in [a,b]\).</p>
<p>Partition \([a,b]\) into cells</p>
<p class="formulaDsp">
\[  I_i = \left[x_{i-\frac{1}{2}}, x_{i+\frac{1}{2}}\right], \quad i=1,\dots,N,
\]
</p>
<p>with \(\Delta x_i = x_{i+\frac{1}{2}} - x_{i-\frac{1}{2}}\) and cell centers \(x_i\). Define the cell average \(\bar{u}_i\) as</p>
<p class="formulaDsp">
\[  \bar{u}_i = \frac{1}{\Delta x_i}\int_{I_i} u\, dx.
\]
</p>
<p>Integrating the PDE over \(I_i\) gives</p>
<p class="formulaDsp">
\[  \frac{d \bar{u}_i}{dt} + \frac{1}{\Delta x_i}\left(J\big\rvert_{x_{i+\frac{1}{2}}} - J\big\rvert_{x_{i-\frac{1}{2}}}\right) = \bar{R}_i.
\]
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Cell-edge interpolation</h2>
<p>For nonuniform grids, cell-edge values are obtained by linear interpolation:</p>
<p class="formulaDsp">
\[  q_{i+\frac{1}{2}} = \frac{x_{i+1}-x_{i+\frac{1}{2}}}{x_{i+1}-x_i} q_i
  + \frac{x_{i+\frac{1}{2}}-x_i}{x_{i+1}-x_i} q_{i+1}.
\]
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
Gradients</h2>
<p>Gradient (and in 1D divergence) terms are handled with the first order expression</p>
<p class="formulaDsp">
\[  \mathrm{grad}_{u, i+\frac{1}{2}} = -p_{i+\frac{1}{2}} \frac{\bar{u}_{i+1}-\bar{u}_i}{x_{i+1}-x_i}.
\]
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Advective flux</h2>
<p>The module provides an expression for stabilized advective fluxes via simple upwinding:</p>
<p class="formulaDsp">
\[  \hat{J}_{\mathrm{advection}, i+\frac{1}{2}} = v^+_{i+\frac{1}{2}} \bar{u}_i + v^-_{i+\frac{1}{2}} \bar{u}_{i+1},
\]
</p>
<p>with</p>
<p class="formulaDsp">
\[  v^\pm_{i+\frac{1}{2}} = \frac{1}{2}\left(v_{i+\frac{1}{2}} \pm |v_{i+\frac{1}{2}}|\right).
\]
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Finite volume transport model building blocks</h1>
<p>The finite volume transport module introduces several small models intended to be composed together:</p>
<ul>
<li><b>LinearlyInterpolateToCellEdges</b>: Interpolates cell-centered values onto cell edges on nonuniform grids.</li>
<li><b>FiniteVolumeGradient</b>: Computes prefactor-weighted gradients at cell edges from \(u\), edge prefactor values, and the spacing between cell centers.</li>
<li><b>FiniteVolumeUpwindedAdvectiveFlux</b>: Computes \(J_{\mathrm{advection}}\) at cell edges with first-order upwinding from \(u\) and edge velocity \(v_{edge}\).</li>
<li><b>FiniteVolumeAppendBoundaryCondition</b>: Appends a boundary value to the left or right side of an intermediate dimension (useful for both Dirichlet and Neumann boundary conditions).</li>
</ul>
<p>In addition, helper tensors are provided for common 1D mesh setups:</p>
<ul>
<li><b>LinspaceScalar</b>: Uniform edge locations or time grids.</li>
<li><b>CenterScalar</b>: Cell centers from edge locations.</li>
<li><b>DifferenceScalar</b>: Cell sizes from edge locations.</li>
<li><b>GaussianScalar</b>: Convenient for initializing Gaussian initial conditions.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
Example: combined advection–diffusion–reaction</h1>
<p>Below is a compact example that assembles a full transport system, applies boundary conditions, and advances in time using backward Euler. The full regression test can be found in tests/regression/finite_volume/combined/model.i.</p>
<div class="fragment"><div class="line">[Tensors]</div>
<div class="line">  [edges]</div>
<div class="line">    type = LinspaceScalar</div>
<div class="line">    start = 0.0</div>
<div class="line">    end = 1.0</div>
<div class="line">    nstep = 201</div>
<div class="line">    dim = 0</div>
<div class="line">    group = &#39;intermediate&#39;</div>
<div class="line">  []</div>
<div class="line">  [centers]</div>
<div class="line">    type = CenterScalar</div>
<div class="line">    points = &#39;edges&#39;</div>
<div class="line">  []</div>
<div class="line">  [dx_centers]</div>
<div class="line">    type = DifferenceScalar</div>
<div class="line">    points = &#39;centers&#39;</div>
<div class="line">  []</div>
<div class="line">  [dx]</div>
<div class="line">    type = DifferenceScalar</div>
<div class="line">    points = &#39;edges&#39;</div>
<div class="line">  []</div>
<div class="line">  [ic]</div>
<div class="line">    type = GaussianScalar </div>
<div class="line">    points = &#39;centers&#39;</div>
<div class="line">    width = 0.05</div>
<div class="line">    height = 1.0</div>
<div class="line">    center = 0.25</div>
<div class="line">  []</div>
<div class="line">  [time]</div>
<div class="line">    type = LinspaceScalar</div>
<div class="line">    start = 0.0</div>
<div class="line">    end = 1.0</div>
<div class="line">    nstep = 25</div>
<div class="line">  []</div>
<div class="line">[]</div>
<div class="line"> </div>
<div class="line">[Drivers]</div>
<div class="line">  [driver]</div>
<div class="line">    type = TransientDriver</div>
<div class="line">    model = &#39;model&#39;</div>
<div class="line">    prescribed_time = &#39;time&#39;</div>
<div class="line">    ic_Scalar_names = &#39;state/concentration&#39;</div>
<div class="line">    ic_Scalar_values = &#39;ic&#39;</div>
<div class="line">    save_as = &#39;result.pt&#39;</div>
<div class="line">  []</div>
<div class="line">  [regression]</div>
<div class="line">    type = TransientRegression</div>
<div class="line">    driver = &#39;driver&#39;</div>
<div class="line">    reference = &#39;gold/result.pt&#39;</div>
<div class="line">  []</div>
<div class="line">[]</div>
<div class="line"> </div>
<div class="line">[EquationSystems]</div>
<div class="line">  [eq_sys]</div>
<div class="line">    type = NonlinearSystem</div>
<div class="line">    model = &#39;implicit_rate&#39;</div>
<div class="line">  []</div>
<div class="line">[]</div>
<div class="line"> </div>
<div class="line">[Solvers]</div>
<div class="line">  [newton]</div>
<div class="line">    type = Newton</div>
<div class="line">    linear_solver = &#39;lu&#39;</div>
<div class="line">  []</div>
<div class="line">  [lu]</div>
<div class="line">    type = DenseLU</div>
<div class="line">  []</div>
<div class="line">[]</div>
<div class="line"> </div>
<div class="line">[Models]</div>
<div class="line">  [diffusivity]</div>
<div class="line">    type = LinearlyInterpolateToCellEdges</div>
<div class="line">    cell_values = 0.5</div>
<div class="line">    cell_centers = &#39;centers&#39;</div>
<div class="line">    cell_edges = &#39;edges&#39;</div>
<div class="line">    edge_values = &#39;state/D&#39;</div>
<div class="line">  []</div>
<div class="line">  [advection_velocity]</div>
<div class="line">    type = LinearlyInterpolateToCellEdges</div>
<div class="line">    cell_values = 0.4</div>
<div class="line">    cell_centers = &#39;centers&#39;</div>
<div class="line">    cell_edges = &#39;edges&#39;</div>
<div class="line">    edge_values = &#39;state/v_edge&#39;</div>
<div class="line">  []</div>
<div class="line">  [diffusive_flux]</div>
<div class="line">    type = FiniteVolumeGradient</div>
<div class="line">    u = &#39;state/concentration&#39;</div>
<div class="line">    prefactor = &#39;state/D&#39;</div>
<div class="line">    dx = &#39;dx_centers&#39;</div>
<div class="line">  []</div>
<div class="line">  [advective_flux]</div>
<div class="line">    type = FiniteVolumeUpwindedAdvectiveFlux</div>
<div class="line">    u = &#39;state/concentration&#39;</div>
<div class="line">    v_edge = &#39;state/v_edge&#39;</div>
<div class="line">  []</div>
<div class="line">  [reaction]</div>
<div class="line">    type = ScalarLinearCombination</div>
<div class="line">    from_var = &#39;state/concentration&#39;</div>
<div class="line">    to_var = &#39;state/R&#39;</div>
<div class="line">    coefficients = &#39;-0.05&#39;</div>
<div class="line">  []</div>
<div class="line">  [total_flux]</div>
<div class="line">    type = ScalarLinearCombination</div>
<div class="line">    from_var = &#39;state/grad_u state/J_advection&#39;</div>
<div class="line">    to_var = &#39;state/J&#39;</div>
<div class="line">    coefficients = &#39;1 1&#39;</div>
<div class="line">  []</div>
<div class="line">  [left_bc]</div>
<div class="line">    type = FiniteVolumeAppendBoundaryCondition</div>
<div class="line">    input = &#39;state/J&#39;</div>
<div class="line">    bc_value = 0.0</div>
<div class="line">    side = &#39;left&#39;</div>
<div class="line">  []</div>
<div class="line">  [right_bc]</div>
<div class="line">    type = FiniteVolumeAppendBoundaryCondition</div>
<div class="line">    input = &#39;state/J_with_bc_left&#39;</div>
<div class="line">    bc_value = 0.0</div>
<div class="line">    side = &#39;right&#39;</div>
<div class="line">  []</div>
<div class="line">  [flux_divergence]</div>
<div class="line">    type = FiniteVolumeGradient</div>
<div class="line">    u = &#39;state/J_with_bc_left_with_bc_right&#39;</div>
<div class="line">    dx = &#39;dx&#39;</div>
<div class="line">    grad_u = &#39;state/flux_div&#39;</div>
<div class="line">  []</div>
<div class="line">  [rate_of_change]</div>
<div class="line">    type = ScalarLinearCombination</div>
<div class="line">    from_var = &#39;state/R state/flux_div&#39;</div>
<div class="line">    to_var = &#39;state/concentration_rate&#39;</div>
<div class="line">    coefficients = &#39;1 1&#39;</div>
<div class="line">  []</div>
<div class="line">  [integrate_u]</div>
<div class="line">    type = ScalarBackwardEulerTimeIntegration</div>
<div class="line">    variable = &#39;state/concentration&#39;</div>
<div class="line">  []</div>
<div class="line">  [implicit_rate]</div>
<div class="line">    type = ComposedModel</div>
<div class="line">    models = &#39;diffusivity advection_velocity diffusive_flux advective_flux reaction total_flux left_bc right_bc flux_divergence rate_of_change integrate_u&#39;</div>
<div class="line">  []</div>
<div class="line">  [model]</div>
<div class="line">    type = ImplicitUpdate</div>
<div class="line">    equation_system = &#39;eq_sys&#39;</div>
<div class="line">    solver = &#39;newton&#39;</div>
<div class="line">  []</div>
<div class="line">[]</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Verification and regression tests</h1>
<p>The module includes unit tests for each component and verification tests for advection, diffusion, and combined advection–diffusion–reaction problems. These are located under tests/unit/models/finite_volume and tests/verification/finite_volume. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
